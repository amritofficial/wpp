<!DOCTYPE html>

<head>
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <style>
        .video-links {
            margin-left: 1%;
        }

        .video-links button {
            margin: 10px;
        }

        .video-links button a {
            text-decoration: none;
        }

        .videoPlayer {
            display: inline-block;
        }

        .controls {
            margin: 10px;
            display: inline-block;
            position: absolute;
            margin-top: 10%;
        }

        .controls button {
            margin: 10px;
        }

    </style>
</head>

<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">CBC</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#">Stream</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="video-links" id="video-links">

    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-12" id="video-container">
                <div id="metadata">

                </div>
                <div id="video-player" class="videoPlayer">

                </div>
                <div class="controls" id="controls">
                    <!-- <button type="button" class="btn btn-success">Success</button> -->
                </div>
            </div>
        </div>
    </div>

    <script>
        var request = new XMLHttpRequest();
        var videoIds = ['1630723954', '2667647842', '1402726504'];
        var responses = [];

        var mainContainer = document.getElementById("video-links");

        for (var i = 0; i < videoIds.length; i++) {
            var btnLink = document.createElement('button');
            var breakTag = document.createElement('br');

            btnLink.className = "btn btn-primary video-link"
            btnLink.id = videoIds[i];
            btnLink.innerHTML = "Link " + (i + 1);

            btnLink.addEventListener('mousedown', function (event) {
                buttonClicked(this, event);
            }, false);
            mainContainer.appendChild(btnLink);
            // mainContainer.appendChild(breakTag)
        }

        function buttonClicked(ref, event) {
            window.location.href = window.location.pathname + "?id=" + ref.id
        }

        window.onload = function () {
            const urlParams = new URLSearchParams(window.location.search);
            const videoId = urlParams.get('id');
            console.log(videoId)
            request.open('GET', 'https://www.cbc.ca/bistro/order?mediaId=' + videoId)
            makeAjaxCall(videoId);
        }

        function makeAjaxCall(id) {
            request.open('GET', 'https://www.cbc.ca/bistro/order?mediaId=' + id, true);
            request.onload = function () {
                var data = JSON.parse(this.response)
                responses.push(data['items'])
                insertData(data['items'][0])
            }
            request.send();
        }

        function insertData(data) {
            var videoContainer = document.getElementById('video-container');
            var metadata = document.getElementById('metadata');
            var controls = document.getElementById('controls');
            var breakTag = document.createElement('br');

            var btnPlay = document.createElement('button');
            var btnPause = document.createElement('button');
            var btnStop = document.createElement('button');

            btnPlay.className = "btn btn-success";
            btnPlay.innerHTML = "Play";
            btnPause.className = "btn btn-secondary";
            btnPause.innerHTML = "Pause";
            btnStop.className = "btn btn-danger";
            btnStop.innerHTML = "Stop";

            var title = document.createElement('h1');
            title.innerHTML = data.title;
            var description = document.createElement('p');
            description.innerHTML = data.description;

            var videoPlayer = document.getElementById('video-player');
            var video = document.createElement('video');
            video.className = 'embed-responsive-item';
            video.style.width = "100%";
            video.style.height = "400px";
            var source = document.createElement('source');

            source.src = data['assetDescriptors'][1].key;
            video.append(source)
            videoPlayer.appendChild(video);

            controls.appendChild(btnPlay);
            controls.append(breakTag);
            controls.appendChild(btnPause);
            controls.append(breakTag);
            controls.appendChild(btnStop);

            metadata.appendChild(title);
            metadata.appendChild(description);
            console.log(data)
        }

    </script>
</body>

</html>